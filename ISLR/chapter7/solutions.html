<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Solutions | </title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.2.0">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../../gitbook/style.css">
    
    

        
    
    
    
    <link rel="prev" href="../../ISLR/chapter7/lab.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="5.2.2" data-basepath="../.." data-revision="Mon Aug 03 2015 17:32:12 GMT+0100 (BST)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="week1/index.html">
            
            <span><b>1.</b> Week 1</span>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="week2/index.html">
            
            <span><b>2.</b> Week 2</span>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="week3/index.html">
            
                
                    <a href="../../week3/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Week 3
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="week3/index.html">
            
                
                    <a href="../../week3/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        Chapter 5. Resampling Methods
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="ISLR/chapter5/lab.html">
            
                
                    <a href="../../ISLR/chapter5/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="ISLR/chapter5/solutions.html">
            
                
                    <a href="../../ISLR/chapter5/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="week4/index.html">
            
                
                    <a href="../../week4/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Week 4
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="week4/index.html">
            
                
                    <a href="../../week4/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        Chapter 3. Linear Regression
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="ISLR/chapter3/lab.html">
            
                
                    <a href="../../ISLR/chapter3/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="ISLR/chapter3/solutions.html">
            
                
                    <a href="../../ISLR/chapter3/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="week5/index.html">
            
                
                    <a href="../../week5/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Week 5
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="week4/index.html">
            
                
                    <a href="../../week4/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        Chapter 4. Classification
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.1" data-path="ISLR/chapter4/lab.html">
            
                
                    <a href="../../ISLR/chapter4/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.1.2" data-path="ISLR/chapter4/solutions.html">
            
                
                    <a href="../../ISLR/chapter4/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="week5/index.html">
            
                
                    <a href="../../week5/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        Chapter 7. Moving Beyond Linearity
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.2.1" data-path="ISLR/chapter7/lab.html">
            
                
                    <a href="../../ISLR/chapter7/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="5.2.2" data-path="ISLR/chapter7/solutions.html">
            
                
                    <a href="../../ISLR/chapter7/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" data-path="week6/index.html">
            
            <span><b>6.</b> Week 6</span>
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="week7/index.html">
            
            <span><b>7.</b> Week 7</span>
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="week8/index.html">
            
            <span><b>8.</b> Week 8</span>
            
            
        </li>
    
        <li class="chapter " data-level="9" data-path="week9/index.html">
            
            <span><b>9.</b> Week 9</span>
            
            
        </li>
    
        <li class="chapter " data-level="10" data-path="week10/index.html">
            
            <span><b>10.</b> Week 10</span>
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../" ></a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h2 id="4-7-exercises">4.7 Exercises</h2>
<pre><code class="lang-r"><span class="hljs-keyword">library</span>(ISLR)
</code></pre>
<h3 id="exercise-3">Exercise 3</h3>
<pre><code class="lang-r">X &lt;- seq(from = -<span class="hljs-number">4</span>, to = +<span class="hljs-number">4</span>, length.out = <span class="hljs-number">500</span>)

Y &lt;- <span class="hljs-number">1</span> + X - <span class="hljs-number">2</span> * (X - <span class="hljs-number">1</span>)^<span class="hljs-number">2</span> * (X &gt;= <span class="hljs-number">1</span>)

plot(X, Y, type = <span class="hljs-string">&quot;l&quot;</span>)
abline(v = <span class="hljs-number">1</span>, col = <span class="hljs-string">&quot;red&quot;</span>)
grid()
</code></pre>
<p><img src="figure/unnamed-chunk-2-1.png" alt="plot of chunk unnamed-chunk-2"> </p>
<h3 id="exercise-4">Exercise 4</h3>
<pre><code class="lang-r">X &lt;- seq(from = -<span class="hljs-number">2</span>, to = +<span class="hljs-number">8</span>, length.out = <span class="hljs-number">500</span>)

<span class="hljs-comment"># Compute some auxilary indicator functions:</span>
I_1 &lt;- (X &gt;= <span class="hljs-number">0</span>) &amp; (X &lt;= <span class="hljs-number">2</span>)
I_2 &lt;- (X &gt;= <span class="hljs-number">1</span>) &amp; (X &lt;= <span class="hljs-number">2</span>)
I_3 &lt;- (X &gt;= <span class="hljs-number">3</span>) &amp; (X &lt;= <span class="hljs-number">4</span>)
I_4 &lt;- (X &gt;= <span class="hljs-number">4</span>) &amp; (X &lt;= <span class="hljs-number">5</span>)

Y &lt;- <span class="hljs-number">1</span> + (I_1 - (X - <span class="hljs-number">1</span>) * I_2) + <span class="hljs-number">3</span> * ((X - <span class="hljs-number">3</span>) * I_3 + I_4)

plot(X, Y, type = <span class="hljs-string">&quot;l&quot;</span>)
grid()
</code></pre>
<p><img src="figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3"> </p>
<h3 id="exercise-6">Exercise 6</h3>
<pre><code class="lang-r"><span class="hljs-keyword">library</span>(boot)

set.seed(<span class="hljs-number">0</span>)

<span class="hljs-comment"># Plot the data to see what it looks like:</span>
with(Wage, plot(age, wage))
</code></pre>
<p><img src="figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4"> </p>
<pre><code class="lang-r"><span class="hljs-comment"># Part (a):</span>

<span class="hljs-comment"># Perform polynomial regression for various polynomial degrees:</span>
cv.error &lt;- rep(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>)
<span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:<span class="hljs-number">10</span>) {
    <span class="hljs-comment"># fit polynomial models of various degrees (based on EPage 208 in the book)</span>
    glm.fit &lt;- glm(wage ~ poly(age, i), data = Wage)
    cv.error[i] &lt;- cv.glm(Wage, glm.fit, K = <span class="hljs-number">10</span>)$delta[<span class="hljs-number">1</span>]
}

plot(<span class="hljs-number">1</span>:<span class="hljs-number">10</span>, cv.error, pch = <span class="hljs-number">19</span>, type = <span class="hljs-string">&quot;b&quot;</span>, xlab = <span class="hljs-string">&quot;degree of polynomial&quot;</span>, ylab = <span class="hljs-string">&quot;CV estimate of the prediction error&quot;</span>)
grid()
</code></pre>
<p><img src="figure/unnamed-chunk-4-2.png" alt="plot of chunk unnamed-chunk-4"> </p>
<pre><code class="lang-r"><span class="hljs-comment"># Using the minimal value for the CV error gives the value 10 which seems like too much polynomial i.e. too wiggly From the plot 4 is</span>
<span class="hljs-comment"># the point where the curve stops decreasing and starts increasing so we will consider polynomials of this degree.</span>
me &lt;- which.min(cv.error)
me &lt;- <span class="hljs-number">4</span>

m &lt;- glm(wage ~ poly(age, me), data = Wage)

plot(Wage$age, Wage$wage)

aRng &lt;- range(Wage$age)

a_predict &lt;- seq(from = aRng[<span class="hljs-number">1</span>], to = aRng[<span class="hljs-number">2</span>], length.out = <span class="hljs-number">100</span>)
w_predict &lt;- predict(m, newdata = list(age = a_predict))
lines(a_predict, w_predict, col = <span class="hljs-string">&quot;red&quot;</span>)
</code></pre>
<p><img src="figure/unnamed-chunk-4-3.png" alt="plot of chunk unnamed-chunk-4"> </p>
<pre><code class="lang-r"><span class="hljs-comment"># Lets consider the ANOVA approach (i.e. a sequence of nested linear models):</span>
m0 &lt;- lm(wage ~ <span class="hljs-number">1</span>, data = Wage)
m1 &lt;- lm(wage ~ poly(age, <span class="hljs-number">1</span>), data = Wage)
m2 &lt;- lm(wage ~ poly(age, <span class="hljs-number">2</span>), data = Wage)
m3 &lt;- lm(wage ~ poly(age, <span class="hljs-number">3</span>), data = Wage)
m4 &lt;- lm(wage ~ poly(age, <span class="hljs-number">4</span>), data = Wage)
m5 &lt;- lm(wage ~ poly(age, <span class="hljs-number">5</span>), data = Wage)
anova(m0, m1, m2, m3, m4, m5)
</code></pre>
<table>
<thead>
<tr>
<th style="text-align:right">Res.Df</th>
<th style="text-align:right">RSS</th>
<th style="text-align:right">Df</th>
<th style="text-align:right">Sum of Sq</th>
<th style="text-align:right">F</th>
<th style="text-align:right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">2999</td>
<td style="text-align:right">5222086</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
</tr>
<tr>
<td style="text-align:right">2998</td>
<td style="text-align:right">5022216</td>
<td style="text-align:right">1</td>
<td style="text-align:right">199869.665</td>
<td style="text-align:right">125.4443235</td>
<td style="text-align:right">0.0000000</td>
</tr>
<tr>
<td style="text-align:right">2997</td>
<td style="text-align:right">4793430</td>
<td style="text-align:right">1</td>
<td style="text-align:right">228786.010</td>
<td style="text-align:right">143.5931074</td>
<td style="text-align:right">0.0000000</td>
</tr>
<tr>
<td style="text-align:right">2996</td>
<td style="text-align:right">4777674</td>
<td style="text-align:right">1</td>
<td style="text-align:right">15755.694</td>
<td style="text-align:right">9.8887559</td>
<td style="text-align:right">0.0016792</td>
</tr>
<tr>
<td style="text-align:right">2995</td>
<td style="text-align:right">4771604</td>
<td style="text-align:right">1</td>
<td style="text-align:right">6070.152</td>
<td style="text-align:right">3.8098134</td>
<td style="text-align:right">0.0510462</td>
</tr>
<tr>
<td style="text-align:right">2994</td>
<td style="text-align:right">4770322</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1282.563</td>
<td style="text-align:right">0.8049758</td>
<td style="text-align:right">0.3696820</td>
</tr>
</tbody>
</table>
<pre><code class="lang-r"><span class="hljs-comment"># Part (b):</span>

<span class="hljs-comment"># Lets due the same thing with the cut function for fitting a piecewise constant model: For some reason the command cv.glm does not</span>
<span class="hljs-comment"># work when we use the &apos;cut&apos; command.  I think it was how I formed the cut factors the first time i.e. not taking bins when some of</span>
<span class="hljs-comment"># the testing data was outside of the training data.  To debug this and understand what is going on we will do cross-validation by</span>
<span class="hljs-comment"># hand.  See EPage 265 in the book on some more information on how to do cross-validation in R.</span>
number_of_bins &lt;- c(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">10</span>)
nc &lt;- length(number_of_bins)

k &lt;- <span class="hljs-number">10</span>
folds &lt;- sample(<span class="hljs-number">1</span>:k, nrow(Wage), replace = <span class="hljs-literal">TRUE</span>)
cv.errors &lt;- matrix(<span class="hljs-literal">NA</span>, k, nc)

<span class="hljs-comment"># Prepare for the type of factors you might obtain (extend the age range a bit):</span>
age_range &lt;- range(Wage$age)
age_range[<span class="hljs-number">1</span>] &lt;- age_range[<span class="hljs-number">1</span>] - <span class="hljs-number">1</span>
age_range[<span class="hljs-number">2</span>] &lt;- age_range[<span class="hljs-number">2</span>] + <span class="hljs-number">1</span>

<span class="hljs-keyword">for</span> (ci <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:nc) {
    <span class="hljs-comment"># for each number of cuts to test</span>
    nob &lt;- number_of_bins[ci]  <span class="hljs-comment"># n(umber) o(f) c(uts) 2, 3, 4 ...</span>

    <span class="hljs-keyword">for</span> (fi <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:k) {
        <span class="hljs-comment"># for each fold</span>

        <span class="hljs-comment"># In this ugly command we: break the &apos;age&apos; variable in the subset of data Wage[folds!=fi,] into &apos;nob&apos; bins that span between the</span>
        <span class="hljs-comment"># smallest and largest values of age observed over the entire dataset.  This allows us to be able to use the function &apos;predict&apos; on</span>
        <span class="hljs-comment"># age values not seen in the training subset.  If we try to &apos;cut&apos; the age variable into bins that are too small they may not contain</span>
        <span class="hljs-comment"># any ages in them.  I&apos;m not sure that lm/glm would be doing something reasonable in that case.  Thus I only do cross-validation on a</span>
        <span class="hljs-comment"># smallish number of bins.</span>
        fit &lt;- glm(wage ~ cut(age, breaks = seq(from = age_range[<span class="hljs-number">1</span>], to = age_range[<span class="hljs-number">2</span>], length.out = (nob + <span class="hljs-number">1</span>))), data = Wage[folds != 
            fi, ])
        y_hat &lt;- predict(fit, newdata = Wage[folds == fi, ])
        cv.errors[fi, ci] &lt;- mean((Wage[folds == fi, ]$wage - y_hat)^<span class="hljs-number">2</span>)
    }

}

cv.errors.mean &lt;- apply(cv.errors, <span class="hljs-number">2</span>, mean)
cv.errors.stderr &lt;- apply(cv.errors, <span class="hljs-number">2</span>, sd)/sqrt(k)

min.cv.index &lt;- which.min(cv.errors.mean)
one_se_up_value &lt;- (cv.errors.mean + cv.errors.stderr)[min.cv.index]

plot(number_of_bins, cv.errors.mean, pch = <span class="hljs-number">19</span>, type = <span class="hljs-string">&quot;b&quot;</span>, xlab = <span class="hljs-string">&quot;number of cut bins&quot;</span>, ylab = <span class="hljs-string">&quot;CV estimate of the prediction error&quot;</span>)
lines(number_of_bins, cv.errors.mean - cv.errors.stderr, lty = <span class="hljs-string">&quot;dashed&quot;</span>)
lines(number_of_bins, cv.errors.mean + cv.errors.stderr, lty = <span class="hljs-string">&quot;dashed&quot;</span>)
abline(h = one_se_up_value, col = <span class="hljs-string">&quot;red&quot;</span>)
grid()
</code></pre>
<p><img src="figure/unnamed-chunk-4-4.png" alt="plot of chunk unnamed-chunk-4"> </p>
<pre><code class="lang-r"><span class="hljs-comment"># Fit the optimal model using all data:</span>
nob &lt;- <span class="hljs-number">3</span>
fit &lt;- glm(wage ~ cut(age, breaks = seq(from = age_range[<span class="hljs-number">1</span>], to = age_range[<span class="hljs-number">2</span>], length.out = (nob + <span class="hljs-number">1</span>))), data = Wage)

plot(Wage$age, Wage$wage)

aRng &lt;- range(Wage$age)

a_predict &lt;- seq(from = aRng[<span class="hljs-number">1</span>], to = aRng[<span class="hljs-number">2</span>], length.out = <span class="hljs-number">100</span>)
w_predict &lt;- predict(fit, newdata = list(age = a_predict))
lines(a_predict, w_predict, col = <span class="hljs-string">&quot;red&quot;</span>, lw = <span class="hljs-number">4</span>)
</code></pre>
<p><img src="figure/unnamed-chunk-4-5.png" alt="plot of chunk unnamed-chunk-4"> </p>
<h3 id="exercise-9">Exercise 9</h3>
<pre><code class="lang-r"><span class="hljs-keyword">library</span>(MASS)
<span class="hljs-keyword">library</span>(splines)

set.seed(<span class="hljs-number">0</span>)

<span class="hljs-comment"># Part (a):</span>
m &lt;- lm(nox ~ poly(dis, <span class="hljs-number">3</span>), data = Boston)

plot(Boston$dis, Boston$nox, xlab = <span class="hljs-string">&quot;dis&quot;</span>, ylab = <span class="hljs-string">&quot;nox&quot;</span>, main = <span class="hljs-string">&quot;third degree polynomial fit&quot;</span>)

dis_range &lt;- range(Boston$dis)
dis_samples &lt;- seq(from = dis_range[<span class="hljs-number">1</span>], to = dis_range[<span class="hljs-number">2</span>], length.out = <span class="hljs-number">100</span>)
y_hat &lt;- predict(m, newdata = list(dis = dis_samples))

lines(dis_samples, y_hat, col = <span class="hljs-string">&quot;red&quot;</span>)
grid()
</code></pre>
<p><img src="figure/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5"> </p>
<pre><code class="lang-r"><span class="hljs-comment"># Part (b-c):</span>
d_max &lt;- <span class="hljs-number">10</span>

<span class="hljs-comment"># The training RSS:</span>
training_rss &lt;- rep(<span class="hljs-literal">NA</span>, d_max)
<span class="hljs-keyword">for</span> (d <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:d_max) {
    m &lt;- lm(nox ~ poly(dis, d), data = Boston)
    training_rss[d] &lt;- sum((m$residuals)^<span class="hljs-number">2</span>)
}

<span class="hljs-comment"># The RSS estimated using cross-validation:</span>
k &lt;- <span class="hljs-number">10</span>
folds &lt;- sample(<span class="hljs-number">1</span>:k, nrow(Boston), replace = <span class="hljs-literal">TRUE</span>)
cv.rss.test &lt;- matrix(<span class="hljs-literal">NA</span>, k, d_max)
cv.rss.train &lt;- matrix(<span class="hljs-literal">NA</span>, k, d_max)

<span class="hljs-keyword">for</span> (d <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:d_max) {
    <span class="hljs-keyword">for</span> (fi <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:k) {
        <span class="hljs-comment"># for each fold</span>
        fit &lt;- lm(nox ~ poly(dis, d), data = Boston[folds != fi, ])

        y_hat &lt;- predict(fit, newdata = Boston[folds != fi, ])
        cv.rss.train[fi, d] &lt;- sum((Boston[folds != fi, ]$nox - y_hat)^<span class="hljs-number">2</span>)

        y_hat &lt;- predict(fit, newdata = Boston[folds == fi, ])
        cv.rss.test[fi, d] &lt;- sum((Boston[folds == fi, ]$nox - y_hat)^<span class="hljs-number">2</span>)
    }
}

cv.rss.train.mean &lt;- apply(cv.rss.train, <span class="hljs-number">2</span>, mean)
cv.rss.train.stderr &lt;- apply(cv.rss.train, <span class="hljs-number">2</span>, sd)/sqrt(k)

cv.rss.test.mean &lt;- apply(cv.rss.test, <span class="hljs-number">2</span>, mean)
cv.rss.test.stderr &lt;- apply(cv.rss.test, <span class="hljs-number">2</span>, sd)/sqrt(k)

min_value &lt;- min(c(cv.rss.test.mean, cv.rss.train.mean))
max_value &lt;- max(c(cv.rss.test.mean, cv.rss.train.mean))

plot(<span class="hljs-number">1</span>:d_max, cv.rss.train.mean, xlab = <span class="hljs-string">&quot;polynomial degree&quot;</span>, ylab = <span class="hljs-string">&quot;RSS&quot;</span>, col = <span class="hljs-string">&quot;red&quot;</span>, pch = <span class="hljs-number">19</span>, type = <span class="hljs-string">&quot;b&quot;</span>, ylim = c(min_value, max_value))
lines(<span class="hljs-number">1</span>:d_max, cv.rss.test.mean, col = <span class="hljs-string">&quot;green&quot;</span>, pch = <span class="hljs-number">19</span>, type = <span class="hljs-string">&quot;b&quot;</span>)
grid()
legend(<span class="hljs-string">&quot;topright&quot;</span>, legend = c(<span class="hljs-string">&quot;train RSS&quot;</span>, <span class="hljs-string">&quot;test RSS&quot;</span>), col = c(<span class="hljs-string">&quot;red&quot;</span>, <span class="hljs-string">&quot;green&quot;</span>), lty = <span class="hljs-number">1</span>, lwd = <span class="hljs-number">2</span>)
</code></pre>
<p><img src="figure/unnamed-chunk-5-2.png" alt="plot of chunk unnamed-chunk-5"> </p>
<pre><code class="lang-r"><span class="hljs-comment"># Part (d-f):</span>
m &lt;- lm(nox ~ bs(dis, df = <span class="hljs-number">4</span>), data = Boston)

plot(Boston$dis, Boston$nox, xlab = <span class="hljs-string">&quot;dis&quot;</span>, ylab = <span class="hljs-string">&quot;nox&quot;</span>, main = <span class="hljs-string">&quot;bs with df=4 fit&quot;</span>)

dis_range &lt;- range(Boston$dis)
dis_samples &lt;- seq(from = dis_range[<span class="hljs-number">1</span>], to = dis_range[<span class="hljs-number">2</span>], length.out = <span class="hljs-number">100</span>)
y_hat &lt;- predict(m, newdata = list(dis = dis_samples))

lines(dis_samples, y_hat, col = <span class="hljs-string">&quot;red&quot;</span>)
grid()
</code></pre>
<p><img src="figure/unnamed-chunk-5-3.png" alt="plot of chunk unnamed-chunk-5"> </p>
<pre><code class="lang-r">dof_choices &lt;- c(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">15</span>, <span class="hljs-number">20</span>)
n_dof_choices &lt;- length(dof_choices)

<span class="hljs-comment"># The RSS estimated using cross-validation:</span>
k &lt;- <span class="hljs-number">5</span>
folds &lt;- sample(<span class="hljs-number">1</span>:k, nrow(Boston), replace = <span class="hljs-literal">TRUE</span>)
cv.rss.test &lt;- matrix(<span class="hljs-literal">NA</span>, k, n_dof_choices)
cv.rss.train &lt;- matrix(<span class="hljs-literal">NA</span>, k, n_dof_choices)

<span class="hljs-keyword">for</span> (di <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:n_dof_choices) {
    <span class="hljs-keyword">for</span> (fi <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:k) {
        <span class="hljs-comment"># for each fold</span>
        fit &lt;- lm(nox ~ bs(dis, df = dof_choices[di]), data = Boston[folds != fi, ])

        y_hat &lt;- predict(fit, newdata = Boston[folds != fi, ])
        cv.rss.train[fi, di] &lt;- sum((Boston[folds != fi, ]$nox - y_hat)^<span class="hljs-number">2</span>)

        y_hat &lt;- predict(fit, newdata = Boston[folds == fi, ])
        cv.rss.test[fi, di] &lt;- sum((Boston[folds == fi, ]$nox - y_hat)^<span class="hljs-number">2</span>)
    }
}
</code></pre>
<pre><code>## Warning in bs(dis, degree = 3L, knots = numeric(0), Boundary.knots =
## c(1.1296, : some &apos;x&apos; values beyond boundary knots may cause ill-conditioned
## bases
</code></pre><pre><code>## Warning in bs(dis, degree = 3L, knots = numeric(0), Boundary.knots =
## c(1.137, : some &apos;x&apos; values beyond boundary knots may cause ill-conditioned
## bases
</code></pre><pre><code>## Warning in bs(dis, degree = 3L, knots = structure(3.2721, .Names =
## &quot;50%&quot;), : some &apos;x&apos; values beyond boundary knots may cause ill-conditioned
## bases
</code></pre><pre><code>## Warning in bs(dis, degree = 3L, knots = structure(3.1121, .Names =
## &quot;50%&quot;), : some &apos;x&apos; values beyond boundary knots may cause ill-conditioned
## bases
</code></pre><pre><code>## Warning in bs(dis, degree = 3L, knots = structure(c(2.39256666666667,
## 4.3549: some &apos;x&apos; values beyond boundary knots may cause ill-conditioned
## bases
</code></pre><pre><code>## Warning in bs(dis, degree = 3L, knots = structure(c(2.3546,
## 4.23906666666667: some &apos;x&apos; values beyond boundary knots may cause ill-
## conditioned bases
</code></pre><pre><code>## Warning in bs(dis, degree = 3L, knots = structure(c(1.74615, 2.08285,
## 2.50505, : some &apos;x&apos; values beyond boundary knots may cause ill-conditioned
## bases
</code></pre><pre><code>## Warning in bs(dis, degree = 3L, knots = structure(c(1.730175, 2.06855,
## 2.49145, : some &apos;x&apos; values beyond boundary knots may cause ill-conditioned
## bases
</code></pre><pre><code>## Warning in bs(dis, degree = 3L, knots = structure(c(1.55856153846154,
## 1.81466923076923, : some &apos;x&apos; values beyond boundary knots may cause ill-
## conditioned bases
</code></pre><pre><code>## Warning in bs(dis, degree = 3L, knots = structure(c(1.56477692307692,
## 1.79141538461538, : some &apos;x&apos; values beyond boundary knots may cause ill-
## conditioned bases
</code></pre><pre><code>## Warning in bs(dis, degree = 3L, knots = structure(c(1.47964444444444,
## 1.65936666666667, : some &apos;x&apos; values beyond boundary knots may cause ill-
## conditioned bases
</code></pre><pre><code>## Warning in bs(dis, degree = 3L, knots = structure(c(1.48462222222222,
## 1.66397777777778, : some &apos;x&apos; values beyond boundary knots may cause ill-
## conditioned bases
</code></pre><pre><code class="lang-r">cv.rss.train.mean &lt;- apply(cv.rss.train, <span class="hljs-number">2</span>, mean)
cv.rss.train.stderr &lt;- apply(cv.rss.train, <span class="hljs-number">2</span>, sd)/sqrt(k)

cv.rss.test.mean &lt;- apply(cv.rss.test, <span class="hljs-number">2</span>, mean)
cv.rss.test.stderr &lt;- apply(cv.rss.test, <span class="hljs-number">2</span>, sd)/sqrt(k)

min_value &lt;- min(c(cv.rss.test.mean, cv.rss.train.mean))
max_value &lt;- max(c(cv.rss.test.mean, cv.rss.train.mean))

plot(dof_choices, cv.rss.train.mean, xlab = <span class="hljs-string">&quot;spline d.o.f.&quot;</span>, ylab = <span class="hljs-string">&quot;RSS&quot;</span>, col = <span class="hljs-string">&quot;red&quot;</span>, pch = <span class="hljs-number">19</span>, type = <span class="hljs-string">&quot;b&quot;</span>, ylim = c(min_value, max_value))
lines(dof_choices, cv.rss.test.mean, col = <span class="hljs-string">&quot;green&quot;</span>, pch = <span class="hljs-number">19</span>, type = <span class="hljs-string">&quot;b&quot;</span>)
grid()
legend(<span class="hljs-string">&quot;topright&quot;</span>, legend = c(<span class="hljs-string">&quot;train RSS&quot;</span>, <span class="hljs-string">&quot;test RSS&quot;</span>), col = c(<span class="hljs-string">&quot;red&quot;</span>, <span class="hljs-string">&quot;green&quot;</span>), lty = <span class="hljs-number">1</span>, lwd = <span class="hljs-number">2</span>)
</code></pre>
<p><img src="figure/unnamed-chunk-5-4.png" alt="plot of chunk unnamed-chunk-5"> </p>
<h3 id="exercise-10">Exercise 10</h3>
<pre><code class="lang-r"><span class="hljs-keyword">library</span>(<span class="hljs-string">&quot;leaps&quot;</span>)
<span class="hljs-keyword">library</span>(<span class="hljs-string">&quot;glmnet&quot;</span>)
<span class="hljs-keyword">library</span>(<span class="hljs-string">&quot;gam&quot;</span>)

set.seed(<span class="hljs-number">0</span>)

<span class="hljs-comment"># Part (a):</span>

<span class="hljs-comment"># Divide the dataset into three parts: training==1, validation==2, and test==3</span>
dataset_part &lt;- sample(<span class="hljs-number">1</span>:<span class="hljs-number">3</span>, nrow(College), replace = <span class="hljs-literal">T</span>, prob = c(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.25</span>, <span class="hljs-number">0.25</span>))

p &lt;- ncol(College) - <span class="hljs-number">1</span>

<span class="hljs-comment"># Fit subsets of various sizes:</span>
regfit.forward &lt;- regsubsets(Outstate ~ ., data = College[dataset_part == <span class="hljs-number">1</span>, ], nvmax = p, method = <span class="hljs-string">&quot;forward&quot;</span>)
print(summary(regfit.forward))
</code></pre>
<pre><code>## Subset selection object
## Call: eval(expr, envir, enclos)
## 17 Variables  (and intercept)
##             Forced in Forced out
## PrivateYes      FALSE      FALSE
## Apps            FALSE      FALSE
## Accept          FALSE      FALSE
## Enroll          FALSE      FALSE
## Top10perc       FALSE      FALSE
## Top25perc       FALSE      FALSE
## F.Undergrad     FALSE      FALSE
## P.Undergrad     FALSE      FALSE
## Room.Board      FALSE      FALSE
## Books           FALSE      FALSE
## Personal        FALSE      FALSE
## PhD             FALSE      FALSE
## Terminal        FALSE      FALSE
## S.F.Ratio       FALSE      FALSE
## perc.alumni     FALSE      FALSE
## Expend          FALSE      FALSE
## Grad.Rate       FALSE      FALSE
## 1 subsets of each size up to 17
## Selection Algorithm: forward
##           PrivateYes Apps Accept Enroll Top10perc Top25perc F.Undergrad
## 1  ( 1 )  &quot; &quot;        &quot; &quot;  &quot; &quot;    &quot; &quot;    &quot; &quot;       &quot; &quot;       &quot; &quot;        
## 2  ( 1 )  &quot;*&quot;        &quot; &quot;  &quot; &quot;    &quot; &quot;    &quot; &quot;       &quot; &quot;       &quot; &quot;        
## 3  ( 1 )  &quot;*&quot;        &quot; &quot;  &quot; &quot;    &quot; &quot;    &quot; &quot;       &quot; &quot;       &quot; &quot;        
## 4  ( 1 )  &quot;*&quot;        &quot; &quot;  &quot; &quot;    &quot; &quot;    &quot; &quot;       &quot; &quot;       &quot; &quot;        
## 5  ( 1 )  &quot;*&quot;        &quot; &quot;  &quot; &quot;    &quot; &quot;    &quot; &quot;       &quot; &quot;       &quot; &quot;        
## 6  ( 1 )  &quot;*&quot;        &quot; &quot;  &quot; &quot;    &quot; &quot;    &quot; &quot;       &quot; &quot;       &quot; &quot;        
## 7  ( 1 )  &quot;*&quot;        &quot; &quot;  &quot; &quot;    &quot; &quot;    &quot; &quot;       &quot; &quot;       &quot; &quot;        
## 8  ( 1 )  &quot;*&quot;        &quot; &quot;  &quot; &quot;    &quot; &quot;    &quot; &quot;       &quot; &quot;       &quot; &quot;        
## 9  ( 1 )  &quot;*&quot;        &quot; &quot;  &quot;*&quot;    &quot; &quot;    &quot; &quot;       &quot; &quot;       &quot; &quot;        
## 10  ( 1 ) &quot;*&quot;        &quot; &quot;  &quot;*&quot;    &quot;*&quot;    &quot; &quot;       &quot; &quot;       &quot; &quot;        
## 11  ( 1 ) &quot;*&quot;        &quot;*&quot;  &quot;*&quot;    &quot;*&quot;    &quot; &quot;       &quot; &quot;       &quot; &quot;        
## 12  ( 1 ) &quot;*&quot;        &quot;*&quot;  &quot;*&quot;    &quot;*&quot;    &quot;*&quot;       &quot; &quot;       &quot; &quot;        
## 13  ( 1 ) &quot;*&quot;        &quot;*&quot;  &quot;*&quot;    &quot;*&quot;    &quot;*&quot;       &quot;*&quot;       &quot; &quot;        
## 14  ( 1 ) &quot;*&quot;        &quot;*&quot;  &quot;*&quot;    &quot;*&quot;    &quot;*&quot;       &quot;*&quot;       &quot; &quot;        
## 15  ( 1 ) &quot;*&quot;        &quot;*&quot;  &quot;*&quot;    &quot;*&quot;    &quot;*&quot;       &quot;*&quot;       &quot;*&quot;        
## 16  ( 1 ) &quot;*&quot;        &quot;*&quot;  &quot;*&quot;    &quot;*&quot;    &quot;*&quot;       &quot;*&quot;       &quot;*&quot;        
## 17  ( 1 ) &quot;*&quot;        &quot;*&quot;  &quot;*&quot;    &quot;*&quot;    &quot;*&quot;       &quot;*&quot;       &quot;*&quot;        
##           P.Undergrad Room.Board Books Personal PhD Terminal S.F.Ratio
## 1  ( 1 )  &quot; &quot;         &quot; &quot;        &quot; &quot;   &quot; &quot;      &quot; &quot; &quot; &quot;      &quot; &quot;      
## 2  ( 1 )  &quot; &quot;         &quot; &quot;        &quot; &quot;   &quot; &quot;      &quot; &quot; &quot; &quot;      &quot; &quot;      
## 3  ( 1 )  &quot; &quot;         &quot;*&quot;        &quot; &quot;   &quot; &quot;      &quot; &quot; &quot; &quot;      &quot; &quot;      
## 4  ( 1 )  &quot; &quot;         &quot;*&quot;        &quot; &quot;   &quot; &quot;      &quot; &quot; &quot; &quot;      &quot; &quot;      
## 5  ( 1 )  &quot; &quot;         &quot;*&quot;        &quot; &quot;   &quot; &quot;      &quot; &quot; &quot;*&quot;      &quot; &quot;      
## 6  ( 1 )  &quot; &quot;         &quot;*&quot;        &quot; &quot;   &quot; &quot;      &quot; &quot; &quot;*&quot;      &quot; &quot;      
## 7  ( 1 )  &quot; &quot;         &quot;*&quot;        &quot; &quot;   &quot;*&quot;      &quot; &quot; &quot;*&quot;      &quot; &quot;      
## 8  ( 1 )  &quot; &quot;         &quot;*&quot;        &quot; &quot;   &quot;*&quot;      &quot; &quot; &quot;*&quot;      &quot;*&quot;      
## 9  ( 1 )  &quot; &quot;         &quot;*&quot;        &quot; &quot;   &quot;*&quot;      &quot; &quot; &quot;*&quot;      &quot;*&quot;      
## 10  ( 1 ) &quot; &quot;         &quot;*&quot;        &quot; &quot;   &quot;*&quot;      &quot; &quot; &quot;*&quot;      &quot;*&quot;      
## 11  ( 1 ) &quot; &quot;         &quot;*&quot;        &quot; &quot;   &quot;*&quot;      &quot; &quot; &quot;*&quot;      &quot;*&quot;      
## 12  ( 1 ) &quot; &quot;         &quot;*&quot;        &quot; &quot;   &quot;*&quot;      &quot; &quot; &quot;*&quot;      &quot;*&quot;      
## 13  ( 1 ) &quot; &quot;         &quot;*&quot;        &quot; &quot;   &quot;*&quot;      &quot; &quot; &quot;*&quot;      &quot;*&quot;      
## 14  ( 1 ) &quot;*&quot;         &quot;*&quot;        &quot; &quot;   &quot;*&quot;      &quot; &quot; &quot;*&quot;      &quot;*&quot;      
## 15  ( 1 ) &quot;*&quot;         &quot;*&quot;        &quot; &quot;   &quot;*&quot;      &quot; &quot; &quot;*&quot;      &quot;*&quot;      
## 16  ( 1 ) &quot;*&quot;         &quot;*&quot;        &quot;*&quot;   &quot;*&quot;      &quot; &quot; &quot;*&quot;      &quot;*&quot;      
## 17  ( 1 ) &quot;*&quot;         &quot;*&quot;        &quot;*&quot;   &quot;*&quot;      &quot;*&quot; &quot;*&quot;      &quot;*&quot;      
##           perc.alumni Expend Grad.Rate
## 1  ( 1 )  &quot; &quot;         &quot;*&quot;    &quot; &quot;      
## 2  ( 1 )  &quot; &quot;         &quot;*&quot;    &quot; &quot;      
## 3  ( 1 )  &quot; &quot;         &quot;*&quot;    &quot; &quot;      
## 4  ( 1 )  &quot; &quot;         &quot;*&quot;    &quot;*&quot;      
## 5  ( 1 )  &quot; &quot;         &quot;*&quot;    &quot;*&quot;      
## 6  ( 1 )  &quot;*&quot;         &quot;*&quot;    &quot;*&quot;      
## 7  ( 1 )  &quot;*&quot;         &quot;*&quot;    &quot;*&quot;      
## 8  ( 1 )  &quot;*&quot;         &quot;*&quot;    &quot;*&quot;      
## 9  ( 1 )  &quot;*&quot;         &quot;*&quot;    &quot;*&quot;      
## 10  ( 1 ) &quot;*&quot;         &quot;*&quot;    &quot;*&quot;      
## 11  ( 1 ) &quot;*&quot;         &quot;*&quot;    &quot;*&quot;      
## 12  ( 1 ) &quot;*&quot;         &quot;*&quot;    &quot;*&quot;      
## 13  ( 1 ) &quot;*&quot;         &quot;*&quot;    &quot;*&quot;      
## 14  ( 1 ) &quot;*&quot;         &quot;*&quot;    &quot;*&quot;      
## 15  ( 1 ) &quot;*&quot;         &quot;*&quot;    &quot;*&quot;      
## 16  ( 1 ) &quot;*&quot;         &quot;*&quot;    &quot;*&quot;      
## 17  ( 1 ) &quot;*&quot;         &quot;*&quot;    &quot;*&quot;
</code></pre><pre><code class="lang-r">reg.summary &lt;- summary(regfit.forward)

<span class="hljs-comment"># Test the trained models on the validation set:</span>
validation.mat &lt;- model.matrix(Outstate ~ ., data = College[dataset_part == <span class="hljs-number">2</span>, ])
val.errors &lt;- rep(<span class="hljs-literal">NA</span>, p)
<span class="hljs-keyword">for</span> (ii <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:p) {
    coefi &lt;- coef(regfit.forward, id = ii)
    pred &lt;- validation.mat[, names(coefi)] %*% coefi
    val.errors[ii] &lt;- mean((College$Outstate[dataset_part == <span class="hljs-number">2</span>] - pred)^<span class="hljs-number">2</span>)
}
</code></pre>
<p>forward selection validation errors 9.662181 &#xD7; 10<sup>6</sup>, 7.3196979 &#xD7; 10<sup>6</sup>, 5.5952072 &#xD7; 10<sup>6</sup>, 4.9324268 &#xD7; 10<sup>6</sup>, 4.5162583 &#xD7; 10<sup>6</sup>, 4.2393923 &#xD7; 10<sup>6</sup>, 4.238819 &#xD7; 10<sup>6</sup>, 4.1866923 &#xD7; 10<sup>6</sup>, 4.1429586 &#xD7; 10<sup>6</sup>, 4.5589137 &#xD7; 10<sup>6</sup>, 4.337677 &#xD7; 10<sup>6</sup>, 4.1818769 &#xD7; 10<sup>6</sup>, 4.199016 &#xD7; 10<sup>6</sup>, 4.204663 &#xD7; 10<sup>6</sup>, 4.2044632 &#xD7; 10<sup>6</sup>, 4.2007718 &#xD7; 10<sup>6</sup>, 4.20792 &#xD7; 10<sup>6</sup></p>
<pre><code class="lang-r">k &lt;- which.min(val.errors)
</code></pre>
<p>smallest validation error for index= 9, with coefficients given by:</p>
<pre><code class="lang-r">coef(regfit.forward, id = k)
</code></pre>
<pre><code>##   (Intercept)    PrivateYes        Accept    Room.Board      Personal 
## -3.423831e+03  2.852109e+03  7.135054e-02  9.408533e-01 -4.539620e-01 
##      Terminal     S.F.Ratio   perc.alumni        Expend     Grad.Rate 
##  4.480521e+01 -4.828169e+01  3.085511e+01  2.249079e-01  3.535524e+01
</code></pre><pre><code class="lang-r">plot(val.errors, xlab = <span class="hljs-string">&quot;Number of variables&quot;</span>, ylab = <span class="hljs-string">&quot;Validation MSE&quot;</span>, pch = <span class="hljs-number">19</span>, type = <span class="hljs-string">&quot;b&quot;</span>)
abline(v = k, col = <span class="hljs-string">&quot;red&quot;</span>)
grid()
</code></pre>
<p><img src="figure/unnamed-chunk-8-1.png" alt="plot of chunk unnamed-chunk-8"> </p>
<pre><code class="lang-r"><span class="hljs-comment"># Predict the best model found on the testing set:</span>
test.mat &lt;- model.matrix(Outstate ~ ., data = College[dataset_part == <span class="hljs-number">3</span>, ])
coefi &lt;- coef(regfit.forward, id = k)
pred &lt;- test.mat[, names(coefi)] %*% coefi
test.error &lt;- mean((College$Outstate[dataset_part == <span class="hljs-number">3</span>] - pred)^<span class="hljs-number">2</span>)
</code></pre>
<p>test error on the optimal subset <code>{r test.error}</code></p>
<pre><code class="lang-r">k &lt;- <span class="hljs-number">3</span>
coefi &lt;- coef(regfit.forward, id = k)
pred &lt;- test.mat[, names(coefi)] %*% coefi
test.error &lt;- mean((College$Outstate[dataset_part == <span class="hljs-number">3</span>] - pred)^<span class="hljs-number">2</span>)
</code></pre>
<p>test error on k=3 subset <code>{r test.error}</code></p>
<pre><code class="lang-r"><span class="hljs-comment"># Part (b):</span>

<span class="hljs-comment"># Combine the training and validation into one &apos;training&apos; dataset</span>
dataset_part[dataset_part == <span class="hljs-number">2</span>] &lt;- <span class="hljs-number">1</span>
dataset_part[dataset_part == <span class="hljs-number">3</span>] &lt;- <span class="hljs-number">2</span>

gam.model &lt;- gam(Outstate ~ s(Expend, <span class="hljs-number">4</span>) + s(Room.Board, <span class="hljs-number">4</span>) + Private, data = College[dataset_part == <span class="hljs-number">1</span>, ])

par(mfrow = c(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>))
plot(gam.model, se = <span class="hljs-literal">TRUE</span>, col = <span class="hljs-string">&quot;blue&quot;</span>)
</code></pre>
<pre><code>## Error in 1:object$nsdf: argument of length 0
</code></pre><pre><code class="lang-r">par(mfrow = c(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>))

<span class="hljs-comment"># Predict the GAM performance on the test dataset:</span>
y_hat &lt;- predict(gam.model, newdata = College[dataset_part == <span class="hljs-number">2</span>, ])
MSE &lt;- mean((College[dataset_part == <span class="hljs-number">2</span>, ]$Outstate - y_hat)^<span class="hljs-number">2</span>)
</code></pre>
<p>gam testing set (MSE) error 4.5701599 &#xD7; 10<sup>6</sup></p>
<h3 id="exercise-11">Exercise 11</h3>
<pre><code class="lang-r">set.seed(<span class="hljs-number">0</span>)

n &lt;- <span class="hljs-number">100</span>

X1 &lt;- rnorm(n)
X2 &lt;- rnorm(n)

<span class="hljs-comment"># the true values of beta_i:</span>
beta_0 &lt;- <span class="hljs-number">3</span>
beta_1 &lt;- <span class="hljs-number">5</span>
beta_2 &lt;- -<span class="hljs-number">0.2</span>

Y &lt;- beta_0 + beta_1 * X1 + beta_2 * X2 + <span class="hljs-number">0.1</span> * rnorm(n)

<span class="hljs-comment"># Part (b):</span>
beta_1_hat &lt;- -<span class="hljs-number">3</span>

n_iters &lt;- <span class="hljs-number">10</span>

beta_0_estimates &lt;- c()
beta_1_estimates &lt;- c()
beta_2_estimates &lt;- c()
<span class="hljs-keyword">for</span> (ii <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:n_iters) {

    a &lt;- Y - beta_1_hat * X1
    beta_2_hat &lt;- lm(a ~ X2)$coef[<span class="hljs-number">2</span>]

    a &lt;- Y - beta_2_hat * X2
    m &lt;- lm(a ~ X1)
    beta_1_hat &lt;- m$coef[<span class="hljs-number">2</span>]

    beta_0_hat &lt;- m$coef[<span class="hljs-number">1</span>]

    beta_0_estimates &lt;- c(beta_0_estimates, beta_0_hat)
    beta_1_estimates &lt;- c(beta_1_estimates, beta_1_hat)
    beta_2_estimates &lt;- c(beta_2_estimates, beta_2_hat)
}

<span class="hljs-comment"># Get the coefficient estimates using lm:</span>
m &lt;- lm(Y ~ X1 + X2)

old_par &lt;- par(mfrow = c(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>))

plot(<span class="hljs-number">1</span>:n_iters, beta_0_estimates, main = <span class="hljs-string">&quot;beta_0&quot;</span>, pch = <span class="hljs-number">19</span>, ylim = c(beta_0 * <span class="hljs-number">0.999</span>, max(beta_0_estimates)))
abline(h = beta_0, col = <span class="hljs-string">&quot;green&quot;</span>, lwd = <span class="hljs-number">4</span>)
abline(h = m$coefficients[<span class="hljs-number">1</span>], col = <span class="hljs-string">&quot;gray&quot;</span>, lwd = <span class="hljs-number">4</span>)
grid()

plot(<span class="hljs-number">1</span>:n_iters, beta_1_estimates, main = <span class="hljs-string">&quot;beta_1&quot;</span>, pch = <span class="hljs-number">19</span>)
abline(h = beta_1, col = <span class="hljs-string">&quot;green&quot;</span>, lwd = <span class="hljs-number">4</span>)
abline(h = m$coefficients[<span class="hljs-number">2</span>], col = <span class="hljs-string">&quot;gray&quot;</span>, lwd = <span class="hljs-number">4</span>)
grid()

plot(<span class="hljs-number">1</span>:n_iters, beta_2_estimates, main = <span class="hljs-string">&quot;beta_2&quot;</span>, pch = <span class="hljs-number">19</span>)
abline(h = beta_2, col = <span class="hljs-string">&quot;green&quot;</span>, lwd = <span class="hljs-number">4</span>)
abline(h = m$coefficients[<span class="hljs-number">3</span>], col = <span class="hljs-string">&quot;gray&quot;</span>, lwd = <span class="hljs-number">4</span>)
grid()
</code></pre>
<p><img src="figure/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11"> </p>
<h3 id="exercise-12">Exercise 12</h3>
<pre><code class="lang-r">set.seed(<span class="hljs-number">0</span>)

p &lt;- <span class="hljs-number">100</span>
n &lt;- <span class="hljs-number">1000</span>

<span class="hljs-comment"># Generate some regression coefficients beta_0, beta_1, ..., beta_p</span>
beta_truth &lt;- rnorm(p + <span class="hljs-number">1</span>)

<span class="hljs-comment"># Generate some data (append a column of ones):</span>
Xs &lt;- c(rep(<span class="hljs-number">1</span>, n), rnorm(n * p))
X &lt;- matrix(data = Xs, nrow = n, ncol = (p + <span class="hljs-number">1</span>), byrow = <span class="hljs-literal">FALSE</span>)

<span class="hljs-comment"># Produce the response:</span>
Y &lt;- X %*% beta_truth + <span class="hljs-number">0.1</span> * rnorm(n)

<span class="hljs-comment"># Get the true estimated coefficient estimates using lm:</span>
m &lt;- lm(Y ~ X - <span class="hljs-number">1</span>)
beta_lm &lt;- m$coeff

<span class="hljs-comment"># Estimate beta_i using backfitting:</span>
beta_hat &lt;- rnorm(p + <span class="hljs-number">1</span>)  <span class="hljs-comment"># initial estimate of beta&apos;s is taken to be random </span>

n_iters &lt;- <span class="hljs-number">10</span>

beta_estimates &lt;- matrix(data = rep(<span class="hljs-literal">NA</span>, n_iters * (p + <span class="hljs-number">1</span>)), nrow = n_iters, ncol = (p + <span class="hljs-number">1</span>))
beta_differences_with_truth &lt;- rep(<span class="hljs-literal">NA</span>, n_iters)
beta_differences_with_LS &lt;- rep(<span class="hljs-literal">NA</span>, n_iters)
<span class="hljs-keyword">for</span> (ii <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:n_iters) {
    <span class="hljs-keyword">for</span> (pi <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>:p) {
        <span class="hljs-comment"># for beta_0, beta_1, ... beta_pi ... beta_p</span>

        <span class="hljs-comment"># Perform simple linear regression on the variable X_pi (assuming we know all other values of beta_pi):</span>
        a &lt;- Y - X[, -(pi + <span class="hljs-number">1</span>)] %*% beta_hat[-(pi + <span class="hljs-number">1</span>)]  <span class="hljs-comment"># remove all predictors except beta_0 </span>

        <span class="hljs-keyword">if</span> (pi == <span class="hljs-number">0</span>) {
            m &lt;- lm(a ~ <span class="hljs-number">1</span>)  <span class="hljs-comment"># estimate a constant </span>
            beta_hat[pi + <span class="hljs-number">1</span>] &lt;- m$coef[<span class="hljs-number">1</span>]
        } <span class="hljs-keyword">else</span> {
            m &lt;- lm(a ~ X[, pi + <span class="hljs-number">1</span>])  <span class="hljs-comment"># estimate the slope on X_pi</span>
            beta_hat[pi + <span class="hljs-number">1</span>] &lt;- m$coef[<span class="hljs-number">2</span>]
        }

    }
    beta_estimates[ii, ] &lt;- beta_hat
    beta_differences_with_truth[ii] &lt;- sqrt(sum((beta_hat - beta_truth)^<span class="hljs-number">2</span>))
    beta_differences_with_LS[ii] &lt;- sqrt(sum((beta_hat - beta_lm)^<span class="hljs-number">2</span>))
}

plot(<span class="hljs-number">1</span>:n_iters, beta_differences_with_LS, main = <span class="hljs-string">&quot;||beta_truth-beta_LS||_2&quot;</span>, pch = <span class="hljs-number">19</span>, type = <span class="hljs-string">&quot;b&quot;</span>)
grid()
</code></pre>
<p><img src="figure/unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12"> </p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../../ISLR/chapter7/lab.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Lab"><i class="fa fa-angle-left"></i></a>
        
        
    </div>
</div>

        
<script src="../../gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
