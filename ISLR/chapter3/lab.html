<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Lab | </title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.2.0">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../../gitbook/style.css">
    
    

        
    
    
    <link rel="next" href="../../ISLR/chapter3/solutions.html" />
    
    
    <link rel="prev" href="../../week4/index.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="4.1.1" data-basepath="../.." data-revision="Mon Aug 03 2015 17:32:12 GMT+0100 (BST)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="week1/index.html">
            
            <span><b>1.</b> Week 1</span>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="week2/index.html">
            
            <span><b>2.</b> Week 2</span>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="week3/index.html">
            
                
                    <a href="../../week3/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Week 3
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="week3/index.html">
            
                
                    <a href="../../week3/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        Chapter 5. Resampling Methods
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="ISLR/chapter5/lab.html">
            
                
                    <a href="../../ISLR/chapter5/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="ISLR/chapter5/solutions.html">
            
                
                    <a href="../../ISLR/chapter5/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="week4/index.html">
            
                
                    <a href="../../week4/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Week 4
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="week4/index.html">
            
                
                    <a href="../../week4/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        Chapter 3. Linear Regression
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="4.1.1" data-path="ISLR/chapter3/lab.html">
            
                
                    <a href="../../ISLR/chapter3/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="ISLR/chapter3/solutions.html">
            
                
                    <a href="../../ISLR/chapter3/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="week5/index.html">
            
                
                    <a href="../../week5/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Week 5
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="week4/index.html">
            
                
                    <a href="../../week4/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        Chapter 4. Classification
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.1" data-path="ISLR/chapter4/lab.html">
            
                
                    <a href="../../ISLR/chapter4/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.1.2" data-path="ISLR/chapter4/solutions.html">
            
                
                    <a href="../../ISLR/chapter4/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="week5/index.html">
            
                
                    <a href="../../week5/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        Chapter 7. Moving Beyond Linearity
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.2.1" data-path="ISLR/chapter7/lab.html">
            
                
                    <a href="../../ISLR/chapter7/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2.2" data-path="ISLR/chapter7/solutions.html">
            
                
                    <a href="../../ISLR/chapter7/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" data-path="week6/index.html">
            
            <span><b>6.</b> Week 6</span>
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="week7/index.html">
            
            <span><b>7.</b> Week 7</span>
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="week8/index.html">
            
            <span><b>8.</b> Week 8</span>
            
            
        </li>
    
        <li class="chapter " data-level="9" data-path="week9/index.html">
            
            <span><b>9.</b> Week 9</span>
            
            
        </li>
    
        <li class="chapter " data-level="10" data-path="week10/index.html">
            
            <span><b>10.</b> Week 10</span>
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../" ></a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h2 id="3-6-lab-linear-regression">3.6 Lab: Linear Regression</h2>
<h3 id="3-6-1-libraries">3.6.1 Libraries</h3>
<p>We use <a href="http://bit.ly/R_library" target="_blank"><code>library()</code></a> to access functionality provided by packages not included in the standard R installation. To install a new package, use the <a href="http://bit.ly/R_install_packages" target="_blank"><code>install.packages()</code></a> function from the command line console.</p>
<pre><code class="lang-r">install.packages(<span class="hljs-string">&quot;ISLR&quot;</span>)
</code></pre>
<p>Start by loading that <code>MASS</code> and <code>ISLR</code> packages that we will be using throughtout this exercise</p>
<pre><code class="lang-r"><span class="hljs-keyword">library</span>(MASS)
<span class="hljs-keyword">library</span>(ISLR)
</code></pre>
<h3 id="3-6-2-simple-linear-regression">3.6.2 Simple Linear Regression</h3>
<p>To access the <code>Boston</code> housing dataset from the <code>MASS</code> package, use the <a href="http://bit.ly/R_attach" target="_blank"><code>attach()</code></a> function</p>
<pre><code class="lang-r"><span class="hljs-keyword">attach</span>(Boston)
</code></pre>
<p>We can use <a href="http://bit.ly/R_head" target="_blank"><code>head()</code></a> and <a href="http://bit.ly/R_names" target="_blank"><code>names()</code></a> to take a look at the Boston dataset</p>
<pre><code class="lang-r">head(Boston)
</code></pre>
<table>
<thead>
<tr>
<th style="text-align:right">crim</th>
<th style="text-align:right">zn</th>
<th style="text-align:right">indus</th>
<th style="text-align:right">chas</th>
<th style="text-align:right">nox</th>
<th style="text-align:right">rm</th>
<th style="text-align:right">age</th>
<th style="text-align:right">dis</th>
<th style="text-align:right">rad</th>
<th style="text-align:right">tax</th>
<th style="text-align:right">ptratio</th>
<th style="text-align:right">black</th>
<th style="text-align:right">lstat</th>
<th style="text-align:right">medv</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0.00632</td>
<td style="text-align:right">18</td>
<td style="text-align:right">2.31</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.538</td>
<td style="text-align:right">6.575</td>
<td style="text-align:right">65.2</td>
<td style="text-align:right">4.0900</td>
<td style="text-align:right">1</td>
<td style="text-align:right">296</td>
<td style="text-align:right">15.3</td>
<td style="text-align:right">396.90</td>
<td style="text-align:right">4.98</td>
<td style="text-align:right">24.0</td>
</tr>
<tr>
<td style="text-align:right">0.02731</td>
<td style="text-align:right">0</td>
<td style="text-align:right">7.07</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.469</td>
<td style="text-align:right">6.421</td>
<td style="text-align:right">78.9</td>
<td style="text-align:right">4.9671</td>
<td style="text-align:right">2</td>
<td style="text-align:right">242</td>
<td style="text-align:right">17.8</td>
<td style="text-align:right">396.90</td>
<td style="text-align:right">9.14</td>
<td style="text-align:right">21.6</td>
</tr>
<tr>
<td style="text-align:right">0.02729</td>
<td style="text-align:right">0</td>
<td style="text-align:right">7.07</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.469</td>
<td style="text-align:right">7.185</td>
<td style="text-align:right">61.1</td>
<td style="text-align:right">4.9671</td>
<td style="text-align:right">2</td>
<td style="text-align:right">242</td>
<td style="text-align:right">17.8</td>
<td style="text-align:right">392.83</td>
<td style="text-align:right">4.03</td>
<td style="text-align:right">34.7</td>
</tr>
<tr>
<td style="text-align:right">0.03237</td>
<td style="text-align:right">0</td>
<td style="text-align:right">2.18</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.458</td>
<td style="text-align:right">6.998</td>
<td style="text-align:right">45.8</td>
<td style="text-align:right">6.0622</td>
<td style="text-align:right">3</td>
<td style="text-align:right">222</td>
<td style="text-align:right">18.7</td>
<td style="text-align:right">394.63</td>
<td style="text-align:right">2.94</td>
<td style="text-align:right">33.4</td>
</tr>
<tr>
<td style="text-align:right">0.06905</td>
<td style="text-align:right">0</td>
<td style="text-align:right">2.18</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.458</td>
<td style="text-align:right">7.147</td>
<td style="text-align:right">54.2</td>
<td style="text-align:right">6.0622</td>
<td style="text-align:right">3</td>
<td style="text-align:right">222</td>
<td style="text-align:right">18.7</td>
<td style="text-align:right">396.90</td>
<td style="text-align:right">5.33</td>
<td style="text-align:right">36.2</td>
</tr>
<tr>
<td style="text-align:right">0.02985</td>
<td style="text-align:right">0</td>
<td style="text-align:right">2.18</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.458</td>
<td style="text-align:right">6.430</td>
<td style="text-align:right">58.7</td>
<td style="text-align:right">6.0622</td>
<td style="text-align:right">3</td>
<td style="text-align:right">222</td>
<td style="text-align:right">18.7</td>
<td style="text-align:right">394.12</td>
<td style="text-align:right">5.21</td>
<td style="text-align:right">28.7</td>
</tr>
</tbody>
</table>
<pre><code class="lang-r">names(Boston)
</code></pre>
<pre><code>##  [1] &quot;crim&quot;    &quot;zn&quot;      &quot;indus&quot;   &quot;chas&quot;    &quot;nox&quot;     &quot;rm&quot;      &quot;age&quot;    
##  [8] &quot;dis&quot;     &quot;rad&quot;     &quot;tax&quot;     &quot;ptratio&quot; &quot;black&quot;   &quot;lstat&quot;   &quot;medv&quot;
</code></pre><p>Now, lets start with a simple linear model with <a href="http://bit.ly/R_lm" target="_blank"><code>lm()</code></a></p>
<pre><code class="lang-r">lm.fit &lt;- lm(medv ~ lstat)
</code></pre>
<p>Instead of attaching the <code>Boston</code> dataset first, we can also specify it directly in <a href="http://bit.ly/R_lm" target="_blank"><code>lm()</code></a>.</p>
<pre><code class="lang-r">lm.fit &lt;- lm(medv ~ lstat, data = Boston)
</code></pre>
<p>We can examine the fitted model, by simply typing its name.</p>
<pre><code class="lang-r">lm.fit
</code></pre>
<pre><code>## 
## Call:
## lm(formula = medv ~ lstat, data = Boston)
## 
## Coefficients:
## (Intercept)        lstat  
##       34.55        -0.95
</code></pre><p>The <a href="http://bit.ly/R_names" target="_blank"><code>names()</code></a> function lists the names of all variables store in the <code>lm.fit</code> model.</p>
<pre><code class="lang-r">names(lm.fit)
</code></pre>
<pre><code>##  [1] &quot;coefficients&quot;  &quot;residuals&quot;     &quot;effects&quot;       &quot;rank&quot;         
##  [5] &quot;fitted.values&quot; &quot;assign&quot;        &quot;qr&quot;            &quot;df.residual&quot;  
##  [9] &quot;xlevels&quot;       &quot;call&quot;          &quot;terms&quot;         &quot;model&quot;
</code></pre><p>We can extract the coefficients estimated by <a href="http://bit.ly/R_lm" target="_blank"><code>lm()</code></a> using the <a href="http://bit.ly/R_coef" target="_blank"><code>coef()</code></a> function, and the confidence interval with the <a href="http://bit.ly/R_coef" target="_blank"><code>confint()</code></a> function.</p>
<pre><code class="lang-r">coef(lm.fit)
</code></pre>
<pre><code>## (Intercept)       lstat 
##  34.5538409  -0.9500494
</code></pre><pre><code class="lang-r">confint(lm.fit)
</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:right">2.5 %</th>
<th style="text-align:right">97.5 %</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">(Intercept)</td>
<td style="text-align:right">33.448457</td>
<td style="text-align:right">35.6592247</td>
</tr>
<tr>
<td style="text-align:left">lstat</td>
<td style="text-align:right">-1.026148</td>
<td style="text-align:right">-0.8739505</td>
</tr>
</tbody>
</table>
<p>We use the <a href="http://bit.ly/R_predict" target="_blank"><code>predict()</code></a> function to obtain prediction interval or confidence intervals for a given value of <code>lstat</code></p>
<pre><code class="lang-r">predict(lm.fit, data.frame(lstat = (c(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">15</span>))), interval = <span class="hljs-string">&quot;confidence&quot;</span>)
</code></pre>
<table>
<thead>
<tr>
<th style="text-align:right">fit</th>
<th style="text-align:right">lwr</th>
<th style="text-align:right">upr</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">29.80359</td>
<td style="text-align:right">29.00741</td>
<td style="text-align:right">30.59978</td>
</tr>
<tr>
<td style="text-align:right">25.05335</td>
<td style="text-align:right">24.47413</td>
<td style="text-align:right">25.63256</td>
</tr>
<tr>
<td style="text-align:right">20.30310</td>
<td style="text-align:right">19.73159</td>
<td style="text-align:right">20.87461</td>
</tr>
</tbody>
</table>
<pre><code class="lang-r">predict(lm.fit, data.frame(lstat = (c(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">15</span>))), interval = <span class="hljs-string">&quot;prediction&quot;</span>)
</code></pre>
<table>
<thead>
<tr>
<th style="text-align:right">fit</th>
<th style="text-align:right">lwr</th>
<th style="text-align:right">upr</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">29.80359</td>
<td style="text-align:right">17.565675</td>
<td style="text-align:right">42.04151</td>
</tr>
<tr>
<td style="text-align:right">25.05335</td>
<td style="text-align:right">12.827626</td>
<td style="text-align:right">37.27907</td>
</tr>
<tr>
<td style="text-align:right">20.30310</td>
<td style="text-align:right">8.077742</td>
<td style="text-align:right">32.52846</td>
</tr>
</tbody>
</table>
<p>We can plot the variables <code>lstat</code> and <code>medv</code> using the <a href="http://bit.ly/R_plot" target="_blank"><code>plot()</code></a> function, and overlay a regression line from our linear model using the <a href="http://bit.ly/R_abline" target="_blank"><code>abline()</code></a> function.</p>
<pre><code class="lang-r">plot(lstat, medv)
abline(lm.fit)
</code></pre>
<p><img src="figure/unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13"> </p>
<p>Experiment with different options for <a href="http://bit.ly/R_abline" target="_blank"><code>abline()</code></a> by changing the line width and color.</p>
<pre><code class="lang-r">plot(lstat, medv)
abline(lm.fit, lwd = <span class="hljs-number">3</span>)
</code></pre>
<p><img src="figure/unnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14"> </p>
<pre><code class="lang-r">plot(lstat, medv)
abline(lm.fit, lwd = <span class="hljs-number">3</span>, col = <span class="hljs-string">&quot;red&quot;</span>)
</code></pre>
<p><img src="figure/unnamed-chunk-15-1.png" alt="plot of chunk unnamed-chunk-15"> </p>
<pre><code class="lang-r">plot(lstat, medv, col = <span class="hljs-string">&quot;red&quot;</span>)
</code></pre>
<p><img src="figure/unnamed-chunk-16-1.png" alt="plot of chunk unnamed-chunk-16"> </p>
<pre><code class="lang-r">plot(lstat, medv, pch = <span class="hljs-number">20</span>)
</code></pre>
<p><img src="figure/unnamed-chunk-16-2.png" alt="plot of chunk unnamed-chunk-16"> </p>
<pre><code class="lang-r">plot(lstat, medv, pch = <span class="hljs-string">&quot;+&quot;</span>)
</code></pre>
<p><img src="figure/unnamed-chunk-16-3.png" alt="plot of chunk unnamed-chunk-16"> </p>
<pre><code class="lang-r">plot(<span class="hljs-number">1</span>:<span class="hljs-number">20</span>, <span class="hljs-number">1</span>:<span class="hljs-number">20</span>, pch = <span class="hljs-number">1</span>:<span class="hljs-number">20</span>)
</code></pre>
<p><img src="figure/unnamed-chunk-16-4.png" alt="plot of chunk unnamed-chunk-16"> </p>
<p>To create a grid of multiple subplots, use the <a href="http://bit.ly/R_par" target="_blank"><code>par()</code></a> function.</p>
<pre><code class="lang-r">par(mfrow = c(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>))
plot(lm.fit)
</code></pre>
<p><img src="figure/unnamed-chunk-17-1.png" alt="plot of chunk unnamed-chunk-17"> </p>
<p>We can extract the residuals and studentized residuals from our linear model using <a href="http://bit.ly/R_residuals" target="_blank"><code>residuals()</code></a> and <a href="http://bit.ly/R_influence_measures" target="_blank"><code>rstudent()</code></a>, and plot them along with the predicted values.</p>
<pre><code class="lang-r">plot(predict(lm.fit), residuals(lm.fit))
</code></pre>
<p><img src="figure/unnamed-chunk-18-1.png" alt="plot of chunk unnamed-chunk-18"> </p>
<pre><code class="lang-r">plot(predict(lm.fit), rstudent(lm.fit))
</code></pre>
<p><img src="figure/unnamed-chunk-18-2.png" alt="plot of chunk unnamed-chunk-18"> </p>
<p>We can compute the influence matrix for the predictors in our fitted model using the <a href="http://bit.ly/R_influence_measures" target="_blank"><code>hatvalues()</code></a> function</p>
<pre><code class="lang-r">plot(hatvalues(lm.fit))
</code></pre>
<p><img src="figure/unnamed-chunk-19-1.png" alt="plot of chunk unnamed-chunk-19"> </p>
<pre><code class="lang-r">which.max(hatvalues(lm.fit))
</code></pre>
<pre><code>## 375 
## 375
</code></pre><h3 id="3-6-3-multiple-linear-regression">3.6.3 Multiple Linear Regression</h3>
<p>The <a href="http://bit.ly/R_lm" target="_blank"><code>lm()</code></a> can be used for fitting multiple regression models as well. In the following example, we include <code>age</code> in addition to <code>lstata</code> as predictors of of our response variable <code>medv</code>. </p>
<pre><code class="lang-r">lm.fit &lt;- lm(medv ~ lstat + age, data = Boston)
summary(lm.fit)
</code></pre>
<pre><code>## 
## Call:
## lm(formula = medv ~ lstat + age, data = Boston)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -15.981  -3.978  -1.283   1.968  23.158 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 33.22276    0.73085  45.458  &lt; 2e-16 ***
## lstat       -1.03207    0.04819 -21.416  &lt; 2e-16 ***
## age          0.03454    0.01223   2.826  0.00491 ** 
## ---
## Signif. codes:  0 &apos;***&apos; 0.001 &apos;**&apos; 0.01 &apos;*&apos; 0.05 &apos;.&apos; 0.1 &apos; &apos; 1
## 
## Residual standard error: 6.173 on 503 degrees of freedom
## Multiple R-squared:  0.5513,    Adjusted R-squared:  0.5495 
## F-statistic:   309 on 2 and 503 DF,  p-value: &lt; 2.2e-16
</code></pre><p>In a formula, a dot <code>.</code> can be used as a shorthand to include all variables from the <code>Boston</code> dataset as predictors.</p>
<pre><code class="lang-r">lm.fit &lt;- lm(medv ~ ., data = Boston)
summary(lm.fit)
</code></pre>
<pre><code>## 
## Call:
## lm(formula = medv ~ ., data = Boston)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -15.595  -2.730  -0.518   1.777  26.199 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  3.646e+01  5.103e+00   7.144 3.28e-12 ***
## crim        -1.080e-01  3.286e-02  -3.287 0.001087 ** 
## zn           4.642e-02  1.373e-02   3.382 0.000778 ***
## indus        2.056e-02  6.150e-02   0.334 0.738288    
## chas         2.687e+00  8.616e-01   3.118 0.001925 ** 
## nox         -1.777e+01  3.820e+00  -4.651 4.25e-06 ***
## rm           3.810e+00  4.179e-01   9.116  &lt; 2e-16 ***
## age          6.922e-04  1.321e-02   0.052 0.958229    
## dis         -1.476e+00  1.995e-01  -7.398 6.01e-13 ***
## rad          3.060e-01  6.635e-02   4.613 5.07e-06 ***
## tax         -1.233e-02  3.760e-03  -3.280 0.001112 ** 
## ptratio     -9.527e-01  1.308e-01  -7.283 1.31e-12 ***
## black        9.312e-03  2.686e-03   3.467 0.000573 ***
## lstat       -5.248e-01  5.072e-02 -10.347  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &apos;***&apos; 0.001 &apos;**&apos; 0.01 &apos;*&apos; 0.05 &apos;.&apos; 0.1 &apos; &apos; 1
## 
## Residual standard error: 4.745 on 492 degrees of freedom
## Multiple R-squared:  0.7406,    Adjusted R-squared:  0.7338 
## F-statistic: 108.1 on 13 and 492 DF,  p-value: &lt; 2.2e-16
</code></pre><p>The Variance Inflation Factors (VIF) can be caculated using the <code>vif()</code> function from the <code>Companion to Applied Regression</code> or <code>car</code> package. You can install the <code>car</code> package using <a href="http://bit.ly/R_install_packages" target="_blank"><code>install.packages()</code></a> if it is not already installed.</p>
<pre><code class="lang-r">install.packages(<span class="hljs-string">&quot;ISLR&quot;</span>)
</code></pre>
<pre><code class="lang-r"><span class="hljs-keyword">library</span>(car)
vif(lm.fit)
</code></pre>
<pre><code>##     crim       zn    indus     chas      nox       rm      age      dis 
## 1.792192 2.298758 3.991596 1.073995 4.393720 1.933744 3.100826 3.955945 
##      rad      tax  ptratio    black    lstat 
## 7.484496 9.008554 1.799084 1.348521 2.941491
</code></pre><p>To exclude specific variables from the list of predictors, we can use the <code>-</code> notation. In the following example, all variables except <code>age</code> are included in the linear fit model.</p>
<pre><code class="lang-r">lm.fit1 &lt;- lm(medv ~ . - age, data = Boston)
summary(lm.fit1)
</code></pre>
<pre><code>## 
## Call:
## lm(formula = medv ~ . - age, data = Boston)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -15.6054  -2.7313  -0.5188   1.7601  26.2243 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  36.436927   5.080119   7.172 2.72e-12 ***
## crim         -0.108006   0.032832  -3.290 0.001075 ** 
## zn            0.046334   0.013613   3.404 0.000719 ***
## indus         0.020562   0.061433   0.335 0.737989    
## chas          2.689026   0.859598   3.128 0.001863 ** 
## nox         -17.713540   3.679308  -4.814 1.97e-06 ***
## rm            3.814394   0.408480   9.338  &lt; 2e-16 ***
## dis          -1.478612   0.190611  -7.757 5.03e-14 ***
## rad           0.305786   0.066089   4.627 4.75e-06 ***
## tax          -0.012329   0.003755  -3.283 0.001099 ** 
## ptratio      -0.952211   0.130294  -7.308 1.10e-12 ***
## black         0.009321   0.002678   3.481 0.000544 ***
## lstat        -0.523852   0.047625 -10.999  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &apos;***&apos; 0.001 &apos;**&apos; 0.01 &apos;*&apos; 0.05 &apos;.&apos; 0.1 &apos; &apos; 1
## 
## Residual standard error: 4.74 on 493 degrees of freedom
## Multiple R-squared:  0.7406,    Adjusted R-squared:  0.7343 
## F-statistic: 117.3 on 12 and 493 DF,  p-value: &lt; 2.2e-16
</code></pre><p>We can also update an existing fit with the <a href="http://bit.ly/R_update" target="_blank"><code>update()</code></a> function and specifiying a new formula.</p>
<pre><code class="lang-r">lm.fit1 &lt;- update(lm.fit, ~. - age)
</code></pre>
<h3 id="3-6-4-interaction-terms">3.6.4 Interaction Terms</h3>
<p>The <code>:</code> and <code>*</code> operators are used to specify interaction terms between variables. The <code>:</code> operator includes just the interaction term between the specified variables as predictor, while the <code>*</code> operator includes the interaction term as well as the variables themselves. In the following example, <code>lstat * age</code> is equivalent to <code>lstat + age + lstat:age</code></p>
<pre><code class="lang-r">summary(lm(medv ~ lstat * age, data = Boston))
</code></pre>
<pre><code>## 
## Call:
## lm(formula = medv ~ lstat * age, data = Boston)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -15.806  -4.045  -1.333   2.085  27.552 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 36.0885359  1.4698355  24.553  &lt; 2e-16 ***
## lstat       -1.3921168  0.1674555  -8.313 8.78e-16 ***
## age         -0.0007209  0.0198792  -0.036   0.9711    
## lstat:age    0.0041560  0.0018518   2.244   0.0252 *  
## ---
## Signif. codes:  0 &apos;***&apos; 0.001 &apos;**&apos; 0.01 &apos;*&apos; 0.05 &apos;.&apos; 0.1 &apos; &apos; 1
## 
## Residual standard error: 6.149 on 502 degrees of freedom
## Multiple R-squared:  0.5557,    Adjusted R-squared:  0.5531 
## F-statistic: 209.3 on 3 and 502 DF,  p-value: &lt; 2.2e-16
</code></pre><h3 id="3-6-5-non-linear-transformations-of-the-predictors">3.6.5 Non-linear Transformations of the Predictors</h3>
<p>The <a href="http://bit.ly/R_lm" target="_blank"><code>lm()</code></a> function can also be non-linear transformations such as quadratic or cubic terms. Terms in the formula raised to a power with <code>^</code> must be wrapped inside a call to <a href="http://bit.ly/R_asis" target="_blank"><code>I()</code></a> to prevent interpretation and treated <code>as is</code>.</p>
<pre><code class="lang-r">lm.fit2 &lt;- lm(medv ~ lstat + I(lstat^<span class="hljs-number">2</span>))
summary(lm.fit2)
</code></pre>
<pre><code>## 
## Call:
## lm(formula = medv ~ lstat + I(lstat^2))
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -15.2834  -3.8313  -0.5295   2.3095  25.4148 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 42.862007   0.872084   49.15   &lt;2e-16 ***
## lstat       -2.332821   0.123803  -18.84   &lt;2e-16 ***
## I(lstat^2)   0.043547   0.003745   11.63   &lt;2e-16 ***
## ---
## Signif. codes:  0 &apos;***&apos; 0.001 &apos;**&apos; 0.01 &apos;*&apos; 0.05 &apos;.&apos; 0.1 &apos; &apos; 1
## 
## Residual standard error: 5.524 on 503 degrees of freedom
## Multiple R-squared:  0.6407,    Adjusted R-squared:  0.6393 
## F-statistic: 448.5 on 2 and 503 DF,  p-value: &lt; 2.2e-16
</code></pre><p>To examine the analysis of variance (ANOVA) for one or more models, we use the <a href="http://bit.ly/R_anova" target="_blank"><code>anova()</code></a>.</p>
<pre><code class="lang-r">lm.fit &lt;- lm(medv ~ lstat)
anova(lm.fit, lm.fit2)
</code></pre>
<table>
<thead>
<tr>
<th style="text-align:right">Res.Df</th>
<th style="text-align:right">RSS</th>
<th style="text-align:right">Df</th>
<th style="text-align:right">Sum of Sq</th>
<th style="text-align:right">F</th>
<th style="text-align:right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">504</td>
<td style="text-align:right">19472.38</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
</tr>
<tr>
<td style="text-align:right">503</td>
<td style="text-align:right">15347.24</td>
<td style="text-align:right">1</td>
<td style="text-align:right">4125.138</td>
<td style="text-align:right">135.1998</td>
<td style="text-align:right">0</td>
</tr>
</tbody>
</table>
<pre><code class="lang-r">par(mfrow = c(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>))
plot(lm.fit2)
</code></pre>
<p><img src="figure/unnamed-chunk-29-1.png" alt="plot of chunk unnamed-chunk-29"> </p>
<pre><code class="lang-r">lm.fit5 &lt;- lm(medv ~ poly(lstat, <span class="hljs-number">5</span>))
summary(lm.fit5)
</code></pre>
<pre><code>## 
## Call:
## lm(formula = medv ~ poly(lstat, 5))
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -13.5433  -3.1039  -0.7052   2.0844  27.1153 
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)       22.5328     0.2318  97.197  &lt; 2e-16 ***
## poly(lstat, 5)1 -152.4595     5.2148 -29.236  &lt; 2e-16 ***
## poly(lstat, 5)2   64.2272     5.2148  12.316  &lt; 2e-16 ***
## poly(lstat, 5)3  -27.0511     5.2148  -5.187 3.10e-07 ***
## poly(lstat, 5)4   25.4517     5.2148   4.881 1.42e-06 ***
## poly(lstat, 5)5  -19.2524     5.2148  -3.692 0.000247 ***
## ---
## Signif. codes:  0 &apos;***&apos; 0.001 &apos;**&apos; 0.01 &apos;*&apos; 0.05 &apos;.&apos; 0.1 &apos; &apos; 1
## 
## Residual standard error: 5.215 on 500 degrees of freedom
## Multiple R-squared:  0.6817,    Adjusted R-squared:  0.6785 
## F-statistic: 214.2 on 5 and 500 DF,  p-value: &lt; 2.2e-16
</code></pre><p>In addition to polynomial transformations, the formula in a linear fit model can also include <a href="http://bit.ly/R_anova" target="_blank"><code>anova()</code></a> transformations as shown in the following example.</p>
<pre><code class="lang-r">summary(lm(medv ~ log(rm), data = Boston))
</code></pre>
<pre><code>## 
## Call:
## lm(formula = medv ~ log(rm), data = Boston)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -19.487  -2.875  -0.104   2.837  39.816 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  -76.488      5.028  -15.21   &lt;2e-16 ***
## log(rm)       54.055      2.739   19.73   &lt;2e-16 ***
## ---
## Signif. codes:  0 &apos;***&apos; 0.001 &apos;**&apos; 0.01 &apos;*&apos; 0.05 &apos;.&apos; 0.1 &apos; &apos; 1
## 
## Residual standard error: 6.915 on 504 degrees of freedom
## Multiple R-squared:  0.4358,    Adjusted R-squared:  0.4347 
## F-statistic: 389.3 on 1 and 504 DF,  p-value: &lt; 2.2e-16
</code></pre><h3 id="3-6-6-qualitative-predictors">3.6.6 Qualitative Predictors</h3>
<p>In this section, we will use the <code>Carseats</code> dataset from the <code>ISLR</code> package. Similar to how we used the <code>Boston</code> dataset, we can make the <code>Carseats</code> dataset available to us with the <a href="http://bit.ly/R_attach" target="_blank"><code>attach()</code></a> function.</p>
<pre><code class="lang-r"><span class="hljs-keyword">attach</span>(Carseats, warn.conflicts = <span class="hljs-literal">FALSE</span>)
</code></pre>
<pre><code class="lang-r">head(Carseats)
</code></pre>
<table>
<thead>
<tr>
<th style="text-align:right">Sales</th>
<th style="text-align:right">CompPrice</th>
<th style="text-align:right">Income</th>
<th style="text-align:right">Advertising</th>
<th style="text-align:right">Population</th>
<th style="text-align:right">Price</th>
<th style="text-align:left">ShelveLoc</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">Education</th>
<th style="text-align:left">Urban</th>
<th style="text-align:left">US</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">9.50</td>
<td style="text-align:right">138</td>
<td style="text-align:right">73</td>
<td style="text-align:right">11</td>
<td style="text-align:right">276</td>
<td style="text-align:right">120</td>
<td style="text-align:left">Bad</td>
<td style="text-align:right">42</td>
<td style="text-align:right">17</td>
<td style="text-align:left">Yes</td>
<td style="text-align:left">Yes</td>
</tr>
<tr>
<td style="text-align:right">11.22</td>
<td style="text-align:right">111</td>
<td style="text-align:right">48</td>
<td style="text-align:right">16</td>
<td style="text-align:right">260</td>
<td style="text-align:right">83</td>
<td style="text-align:left">Good</td>
<td style="text-align:right">65</td>
<td style="text-align:right">10</td>
<td style="text-align:left">Yes</td>
<td style="text-align:left">Yes</td>
</tr>
<tr>
<td style="text-align:right">10.06</td>
<td style="text-align:right">113</td>
<td style="text-align:right">35</td>
<td style="text-align:right">10</td>
<td style="text-align:right">269</td>
<td style="text-align:right">80</td>
<td style="text-align:left">Medium</td>
<td style="text-align:right">59</td>
<td style="text-align:right">12</td>
<td style="text-align:left">Yes</td>
<td style="text-align:left">Yes</td>
</tr>
<tr>
<td style="text-align:right">7.40</td>
<td style="text-align:right">117</td>
<td style="text-align:right">100</td>
<td style="text-align:right">4</td>
<td style="text-align:right">466</td>
<td style="text-align:right">97</td>
<td style="text-align:left">Medium</td>
<td style="text-align:right">55</td>
<td style="text-align:right">14</td>
<td style="text-align:left">Yes</td>
<td style="text-align:left">Yes</td>
</tr>
<tr>
<td style="text-align:right">4.15</td>
<td style="text-align:right">141</td>
<td style="text-align:right">64</td>
<td style="text-align:right">3</td>
<td style="text-align:right">340</td>
<td style="text-align:right">128</td>
<td style="text-align:left">Bad</td>
<td style="text-align:right">38</td>
<td style="text-align:right">13</td>
<td style="text-align:left">Yes</td>
<td style="text-align:left">No</td>
</tr>
<tr>
<td style="text-align:right">10.81</td>
<td style="text-align:right">124</td>
<td style="text-align:right">113</td>
<td style="text-align:right">13</td>
<td style="text-align:right">501</td>
<td style="text-align:right">72</td>
<td style="text-align:left">Bad</td>
<td style="text-align:right">78</td>
<td style="text-align:right">16</td>
<td style="text-align:left">No</td>
<td style="text-align:left">Yes</td>
</tr>
</tbody>
</table>
<pre><code class="lang-r">names(Carseats)
</code></pre>
<pre><code>##  [1] &quot;Sales&quot;       &quot;CompPrice&quot;   &quot;Income&quot;      &quot;Advertising&quot; &quot;Population&quot; 
##  [6] &quot;Price&quot;       &quot;ShelveLoc&quot;   &quot;Age&quot;         &quot;Education&quot;   &quot;Urban&quot;      
## [11] &quot;US&quot;
</code></pre><p>When dealing with qualitative or categorial variable, <code>R</code> automatically generates dummy variables for us. </p>
<pre><code class="lang-r">lm.fit &lt;- lm(Sales ~ . + Income:Advertising + Price:Age, data = Carseats)
summary(lm.fit)
</code></pre>
<pre><code>## 
## Call:
## lm(formula = Sales ~ . + Income:Advertising + Price:Age, data = Carseats)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.9208 -0.7503  0.0177  0.6754  3.3413 
## 
## Coefficients:
##                      Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)         6.5755654  1.0087470   6.519 2.22e-10 ***
## CompPrice           0.0929371  0.0041183  22.567  &lt; 2e-16 ***
## Income              0.0108940  0.0026044   4.183 3.57e-05 ***
## Advertising         0.0702462  0.0226091   3.107 0.002030 ** 
## Population          0.0001592  0.0003679   0.433 0.665330    
## Price              -0.1008064  0.0074399 -13.549  &lt; 2e-16 ***
## ShelveLocGood       4.8486762  0.1528378  31.724  &lt; 2e-16 ***
## ShelveLocMedium     1.9532620  0.1257682  15.531  &lt; 2e-16 ***
## Age                -0.0579466  0.0159506  -3.633 0.000318 ***
## Education          -0.0208525  0.0196131  -1.063 0.288361    
## UrbanYes            0.1401597  0.1124019   1.247 0.213171    
## USYes              -0.1575571  0.1489234  -1.058 0.290729    
## Income:Advertising  0.0007510  0.0002784   2.698 0.007290 ** 
## Price:Age           0.0001068  0.0001333   0.801 0.423812    
## ---
## Signif. codes:  0 &apos;***&apos; 0.001 &apos;**&apos; 0.01 &apos;*&apos; 0.05 &apos;.&apos; 0.1 &apos; &apos; 1
## 
## Residual standard error: 1.011 on 386 degrees of freedom
## Multiple R-squared:  0.8761,    Adjusted R-squared:  0.8719 
## F-statistic:   210 on 13 and 386 DF,  p-value: &lt; 2.2e-16
</code></pre><p>To examine the coding for the qualitive variables, we can use the <a href="http://bit.ly/R_contrasts" target="_blank"><code>contrasts()</code></a> function.</p>
<pre><code class="lang-r">contrasts(ShelveLoc)
</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:right">Good</th>
<th style="text-align:right">Medium</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Bad</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:left">Good</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:left">Medium</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<h3 id="3-6-7-writing-functions">3.6.7 Writing Functions</h3>
<p>We can define our own functions to wrap a set of <code>R</code> commands in a single call. In the following example, we define a <code>LoadLibraries</code> function that loads the <code>ISLR</code> and <code>MASS</code> packages.</p>
<pre><code class="lang-r">LoadLibraries &lt;- <span class="hljs-keyword">function</span>() {
    <span class="hljs-keyword">library</span>(ISLR)
    <span class="hljs-keyword">library</span>(MASS)
}
</code></pre>
<p>The function then simply be called just like any other function supplied with <code>R</code>.</p>
<pre><code class="lang-r">LoadLibraries()
</code></pre>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../../week4/index.html" class="navigation navigation-prev " aria-label="Previous page: Chapter 3. Linear Regression"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../../ISLR/chapter3/solutions.html" class="navigation navigation-next " aria-label="Next page: Solutions"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../../gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
